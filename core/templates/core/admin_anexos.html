{% extends 'core/base_admin.html' %}
{% load static %}

{% block title %}AdministraciÃ³n de Documentos Requeridos{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/admin_anexos.css' %}">
{% endblock %}

{% block content %}
<div class="contenedor-principal">

    <h2 class="titulo-seccion titulo-centrado">AdministraciÃ³n de Documentos Requeridos</h2>

    <!-- Toasts -->
    <div id="toast-container">
        {% if messages %}
            {% for message in messages %}
            <div class="toast toast-{{ message.tags }}">
                {{ message }}
                <span class="cerrar" onclick="this.parentElement.style.display='none';">&times;</span>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- Formulario para agregar -->
    <div class="tarjeta-formulario">
        <h4>Agregar nuevo documento requerido</h4>
        <form method="post" class="formulario-anexo">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_nombre">Nombre:</label>
                {{ form.nombre }}
            </div>
            <div class="form-group">
                <label for="id_descripcion">DescripciÃ³n:</label>
                {{ form.descripcion }}
            </div>
            <button type="submit" class="btn btn-success">Guardar</button>
        </form>
    </div>

    <!-- Tabla de anexos -->
    <div class="tabla-anexos mt-4">
        <h4>Documentos actualmente requeridos</h4>
        {% if anexos %}
        <table class="tabla-estilo">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>DescripciÃ³n</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for anexo in anexos %}
                <tr>
                    <td>{{ anexo.nombre }}</td>
                    <td>{{ anexo.descripcion|default:"â€”" }}</td>
                    <td>
                        <a href="{% url 'eliminar_anexo' anexo.id %}" class="btn btn-danger btn-sm"
                           onclick="return confirm('Â¿EstÃ¡s seguro de eliminar este documento requerido?');">
                            Eliminar
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No hay documentos registrados aÃºn.</p>
        {% endif %}
    </div>

    <!-- Botones -->
    <div class="contenedor-botones" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">

        <!-- Limpiar anexos subidos -->
        <form method="post" action="{% url 'limpiar_anexos' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-warning btn-sm"
                style="background-color: #621d28; border-color: #621d28; padding: 10px 20px; color: white; border-radius: 8px;"
                onclick="return confirm('Â¿Seguro que deseas limpiar todos los archivos subidos por las entidades?');">
                ðŸ”„ Limpiar anexos subidos
            </button>
        </form>

        <!-- Respaldar anexos -->
        <form method="post" action="{% url 'respaldar_anexos' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm"
                style="background-color: #621d28; border-color: #621d28; padding: 10px 20px; color: white; border-radius: 8px;"
                onclick="return confirm('Â¿Seguro que deseas respaldar los archivos subidos?');">
                ðŸ“¦ Respaldar anexos
            </button>
        </form>

        <!-- Ver anexos respaldados -->
        <a href="{% url 'vista_respaldo_anexos' %}" class="btn btn-info btn-sm"
           style="background-color: #621d28; border-color: #621d28; padding: 10px 20px; color: white; border-radius: 8px; text-decoration: none;">
            ðŸ—‚ Ver anexos respaldados
        </a>

    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
setTimeout(() => {
    const toasts = document.querySelectorAll('.toast');
    toasts.forEach(t => t.remove());
}, 5000);
</script>
{% endblock %}
